<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>rCharts</title>
    <link rel="stylesheet" href="../libraries/frameworks/minimal/stylesheets/styles.css">
    <link rel="stylesheet" href="../libraries/highlighters/prettify/css/twitter-bootstrap.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
        <link rel=stylesheet href="http://fonts.googleapis.com/css?family=PT+Sans"></link>
<link rel=stylesheet href="../assets/css/app.css"></link>
<link rel=stylesheet href="../assets/css/gh-buttons.css"></link>
<link rel=stylesheet href="http://odyniec.net/articles/turning-lists-into-trees/css/tree.css"></link>

    
  </head>
  <body>
    <div class="wrapper">
<header>
  <h1>
    <img src="http://ramnathv.github.io/rCharts/libraries/frameworks/minimal/images/rCharts.png">
  </h1>
  <p></p>
  
  <!-- <img width='150px' src='assets/img/'></img>
  -->
  <p class="view">
    <!-- <a href="http://github.com/rcharts/howitworks">
     View the Project on GitHub <small>rcharts/howitworks</small>
    </a>
    <img width='150px' src='assets/img/'></img>
    -->
  </p>
  <ul class='buttons'>
    <li><a href="https://github.com/rcharts/howitworks/zipball/gh-pages">
      Download <strong>ZIP File</strong>
    </a></li>
    <li><a href="https://github.com/rcharts/howitworks/tarball/gh-pages">
      Download <strong>TAR Ball</strong>
    </a></li>
    <li><a href="http://github.com/rcharts/howitworks">
      Fork On <strong>GitHub</strong></a>
    </li>
  </ul>
    <ol>
    </ol>
  <p><a href='http://rcharts.io'>rCharts</a> is an R package, that helps create, customize and share interactive javascript visualizations from R, using a familiar lattice-like interface. You can install it from <a href='http://ramnathv.github.io/rCharts'>github</a>
  </p>
</header>

      <section>
        <h1>How rCharts Works?</h1>
<h4>Part 2</h4>

<!-- AddThis Smart Layers BEGIN -->

<!-- Go to http://www.addthis.com/get/smart-layers to customize -->

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4fdfcfd4773d48d3"></script>

<script type="text/javascript">
  addthis.layers({
    'theme' : 'transparent',
    'share' : {
      'position' : 'left',
      'numPreferredServices' : 5
    }   
  });
</script>

<!-- AddThis Smart Layers END -->

<p><a href="http://prose.io/#rcharts/howitworks/edit/gh-pages/index.Rmd" class="button icon edit">Edit Page</a></p>

<p>This is a multi-part series on how rCharts works. My objective is to show you how easy it is to integrate a javascript visualization library into rCharts, and take advantage of a single-unified interface and other functionalities.</p>

<p>In the <a href="http://rcharts.io/howitworks">first part</a>, I showed you how to integrate <a href="http://imaginea.github.io/uvCharts/">uvCharts</a> with rCharts, and create a simple barchart, straight from R. In this second part, I will take you through the steps required to expose the full API of uvCharts, so that all customization features are directly accessible from R.</p>

<h2>uvCharts</h2>

<p>From the <a href="http://imaginea.github.io/uvCharts/documentation.html">documentation page</a> of uvCharts, we observe that all charts are specified using a single function that accepts three arguments.</p>

<pre><code class="js">var chartObject = uv.chart(chartType, graphDefinition, optionalConfiguration)
</code></pre>

<p><iframe
  style="width: 100%; height: 650px"
  src="http://jsfiddle.net/ramnathv/w669V/2/embedded/js,result">
</iframe></p>

<p><code>chartType</code> is a string that specifies the type of the chart (e.g. BarChart). <code>graphDefinition</code> is a json object consisting of <code>categories</code> and <code>dataset</code>, that specify the different groups and the dataset (name-value pairs) corresponding to each group. <code>optionalConfiguration</code> is a json object consisting of different configuration elements (e.g. <code>meta</code>, <code>margin</code> etc), each of which consists of key-value pairs.</p>

<p>Our objective now is to translate this javascript into a mustache layout and populate it with data and parameters from R</p>

<h2>Layout</h2>
<p>The mustache layout shown below is a modified version of what we developed in Part 1. The basic idea is to bundle the entire payload into a single json object <code>chartParams</code> (which is returned by default), and recover <code>graphdef</code>, <code>config</code> and <code>type</code> from it. Just as a reminder <code>foo.bar</code> in javascript is equivalent to <code>foo$bar</code> in R.</p>

<pre><code class="html">&lt;script&gt;
  var chartParams = {{{ chartParams }}},
      graphdef = chartParams.graphdef,
      config = chartParams.config

  config.meta.position = &#39;#{{chartId}}&#39;

  var chart = uv.chart(chartParams.type, graphdef, config);
&lt;/script&gt;
</code></pre>

<h2>Reference Class</h2>
<p><code>rCharts</code> uses an object-oriented approach called reference classes, that allows common functionality to be bundled into a parent class, and library specific functionality to be defined or overridden in the child class.</p>

<p>In Part 1 of this series, we had directly used the <code>rCharts</code> base class and the generic <code>set</code> and <code>setLib</code> methods to integrate <code>uvCharts</code>. However, for greater flexibility, it is better to implement <code>uvCharts</code> as a separate class.</p>

<pre><code class="r">Uvcharts &lt;- setRefClass(&#39;Uvcharts&#39;, contains = &#39;rCharts&#39;, 
  methods = list(
    initialize = function(){
      callSuper()
      params$config &lt;&lt;- list(meta = list(position = &quot;#uv-div&quot;))
    },
    config = function(..., replace = F){
      params$config &lt;&lt;- setSpec(params$config, ..., replace = replace)
    }
  )
)
</code></pre>

<p>We define the <code>Uvcharts</code> class to be a child class that inherits from the parent <code>rCharts</code> class. The <code>initialize</code> method executes the default initialization code for all <code>rCharts</code> classes using <code>callSuper()</code>, and then sets the <code>meta</code> parameter of <code>config</code> to &#39;#uv-div&#39;.</p>

<p>The <code>config</code> method allows different configuration elements to be specified easily without having to resort to a convoluted sequence of nested lists. Note that these methods allows users to build a visualization in steps, rather than having to specify everything in a single function call.</p>

<p>Our final step is to wrap all this into a <code>uPlot</code> function. To keep things flexible, we use the <code>...</code> parameter to allow a user to specify configuration related parameters directly using <code>uPlot</code>.</p>

<pre><code class="r">uPlot &lt;- function(x, y, data, group = NULL, type, ...){
  dataset = make_dataset(x = x, y = y, data = data, group = group)
  u1 &lt;- Uvcharts$new()
  u1$set(graphdef = list(
    categories = names(dataset),
    dataset = dataset
  ))
  u1$set(type = type)
  if (length(list(...)) &gt; 0){
   u1$config(...)
  }
  return(u1)
}
</code></pre>

<p>Now, it is time to recreate the chart</p>

<pre><code class="r">hair_eye_male &lt;- subset(as.data.frame(HairEyeColor), Sex == &quot;Male&quot;)
dataset = make_dataset(&#39;Hair&#39;, &#39;Freq&#39;, hair_eye_male, group = &#39;Eye&#39;)
u1 &lt;- uPlot(&quot;Hair&quot;, &quot;Freq&quot;, 
  data = hair_eye_male, 
  group = &quot;Eye&quot;,
  type = &#39;StackedBar&#39;
)
u1$config(meta = list(
  caption = &quot;Hair vs. Eye Colors&quot;,
  vlabel  = &quot;Hair Color&quot;
))
u1$config(graph = list(
  palette = &quot;Olive&quot;  
))
u1
</code></pre>

<iframe src=assets/fig/myplot.html seamless></iframe>

<h3>Acknowledgements</h3>

<p>I would like to thank <a href="http://github.com/timelyportfolio">TimelyPortfolio</a> for his valuable suggestions and comments, which helped improve this post.</p>

<div id='disqus_thread'></div>

      </section>
      <footer>
        <p>Maintained by <a href="http://github.com/rcharts">
          Ramnath Vaidyanathan
        </a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by 
          <a href="https://github.com/orderedlist">orderedlist</a></small>
        </p>
      </footer>    </div>
    <script src="../libraries/frameworks/minimal/javascripts/scale.fix.js"></script>
  </body>
  <!-- Load Javascripts for Widgets -->
  
  <script type="text/javascript">
    var disqus_shortname = 'rcharts';
    (function() {
      var dsq = document.createElement('script'); 
      dsq.type = 'text/javascript'; 
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-36046354-2', 'rcharts.io');
    ga('send', 'pageview');
  
  </script>
  <!-- Google Prettify -->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <script src='../libraries/highlighters/prettify/js/lang-r.js'></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i=0; i < pres.length; ++i) {
      pres[i].className = "prettyprint linenums";
    }
    prettyPrint();
  </script>
  <!-- End Google Prettify --> 
  </html>